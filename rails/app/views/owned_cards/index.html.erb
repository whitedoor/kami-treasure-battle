<div class="ktb-page" style="place-items: start; padding-top: 22px;">
  <div style="width: 100%;">
    <div class="ktb-note" style="max-width: 980px; margin: 0 auto 14px; text-align: left;">
      <div style="font-weight: 900; font-size: 18px; opacity: 0.95;">保持カード一覧</div>
      <div style="opacity: 0.85; margin-top: 6px;">
        いま保持しているカードです。タップすると詳細を開きます。
      </div>
    </div>

    <% if @owned_cards.empty? %>
      <div class="ktb-note" style="max-width: 980px; margin: 0 auto;">
        まだカードがありません。まずは <%= link_to "レシートをアップロード", new_receipt_path %> してください。
      </div>
    <% else %>
      <div class="ktb-grid">
        <% @owned_cards.each do |owned| %>
          <% card = owned.card %>
          <% is_starter_card = (card.rarity == "normal") %>
          <% frame_theme =
               if is_starter_card
                 case card.hand
                 when "gu" then "starter-gu"
                 when "choki" then "starter-choki"
                 when "pa" then "starter-pa"
                 else "starter"
                 end
               else
                 case card.rarity
                 when "bronze", "silver", "gold", "legend" then card.rarity
                 else "normal"
                 end
               end %>
          <%= link_to card_path(card), style: "text-decoration:none; color: inherit;" do %>
            <div class="ktb-card ktb-card--mini" aria-label="カード">
              <div class="ktb-frame ktb-frame--ornate ktb-frame--<%= frame_theme %>">
                <div class="ktb-frame__inner">
                  <% hand_emoji = (card.hand == "gu" ? "✊" : (card.hand == "choki" ? "✌️" : "🖐️")) %>
                  <% hand_label = (card.hand == "gu" ? "グー" : (card.hand == "choki" ? "チョキ" : "パー")) %>
                  <div class="ktb-card__header" aria-label="カード名とタイプ">
                    <div class="ktb-badge ktb-badge--handTitle" aria-label="<%= hand_label %>" title="<%= hand_label %>">
                      <span><%= hand_emoji %></span>
                    </div>
                    <div class="ktb-card__title"><%= card.name %></div>
                    <div class="ktb-card__headerSpacer" aria-hidden="true"></div>
                  </div>

                  <div class="ktb-card__art">
                    <div class="ktb-card__artSquare" aria-label="画像（正方形トリミング表示）">
                      <img
                        src="<%= image_card_path(card, v: (card.artwork_generation || card.updated_at.to_i)) %>"
                        alt="card image"
                        class="ktb-card__artImage"
                        loading="lazy"
                        decoding="async"
                      >
                    </div>
                  </div>

                  <div class="ktb-card__footer">
                    <div class="ktb-card__attack" aria-label="攻撃力">
                      攻撃力 <span class="ktb-card__attackValue"><%= card.attack_power %></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

