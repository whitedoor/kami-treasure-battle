<div
  class="ktb-page"
  data-controller="card-artwork"
  data-card-artwork-card-id-value="<%= @card.id %>"
  data-card-artwork-status-value="<%= @card.artwork_status %>"
  data-card-artwork-generate-url-value="<%= generate_artwork_card_path(@card, format: :json) %>"
  data-card-artwork-poll-url-value="<%= card_path(@card, format: :json) %>"
>
  <div>

    <div class="ktb-note" style="margin-bottom: 12px;">
      <div style="opacity: 0.9;">
        <span
          data-card-artwork-target="errorText"
          style="color: #ffb4b4; display: <%= @card.artwork_error.present? ? 'inline' : 'none' %>;"
        >
          ï¼ˆ<%= @card.artwork_error %>ï¼‰
        </span>
      </div>
    </div>

    <% is_starter_card = (@card.rarity == "normal") %>
    <% frame_theme =
         if is_starter_card
           case @card.hand
           when "gu" then "starter-gu"
           when "choki" then "starter-choki"
           when "pa" then "starter-pa"
           else "starter"
           end
         else
           case @card.rarity
           when "bronze", "silver", "gold", "legend" then @card.rarity
           else "normal"
           end
         end %>
    <div class="ktb-card" aria-label="ã‚«ãƒ¼ãƒ‰è¡¨ç¤º">
      <div class="ktb-frame ktb-frame--ornate ktb-frame--<%= frame_theme %>">
        <div class="ktb-frame__inner">
          <% hand_emoji = (@card.hand == "gu" ? "âœŠ" : (@card.hand == "choki" ? "âœŒï¸" : "ğŸ–ï¸")) %>
          <% hand_label = (@card.hand == "gu" ? "ã‚°ãƒ¼" : (@card.hand == "choki" ? "ãƒãƒ§ã‚­" : "ãƒ‘ãƒ¼")) %>
          <div class="ktb-card__header" aria-label="ã‚«ãƒ¼ãƒ‰åã¨ã‚¿ã‚¤ãƒ—">
            <div class="ktb-badge ktb-badge--handTitle" aria-label="<%= hand_label %>" title="<%= hand_label %>">
              <span><%= hand_emoji %></span>
            </div>
            <div class="ktb-card__title"><%= @card.name %></div>
            <div class="ktb-card__headerSpacer" aria-hidden="true"></div>
          </div>

          <div class="ktb-card__art">
            <div class="ktb-card__artSquare" aria-label="ç”»åƒï¼ˆæ­£æ–¹å½¢ãƒˆãƒªãƒŸãƒ³ã‚°è¡¨ç¤ºï¼‰">
              <% refining = %w[pending generating].include?(@card.artwork_status) %>
              <div
                class="ktb-card__artSkeleton"
                style="display: <%= refining ? '' : 'none' %>;"
                data-card-artwork-target="skeleton"
                role="status"
                aria-label="ã‚«ãƒ¼ãƒ‰ç”»åƒã‚’éŒ¬æˆä¸­"
                aria-live="polite"
              >
                <div class="ktb-card__artSkeleton__content">
                  <div class="ktb-card__artSkeleton__glyph" aria-hidden="true">âœ¦</div>
                  <div class="ktb-card__artSkeleton__text">éŒ¬æˆä¸­â€¦</div>
                  <div class="ktb-card__artSkeleton__subtext">ã¾ã‚‚ãªãã‚«ãƒ¼ãƒ‰ç”»åƒãŒå®Œæˆã—ã¾ã™</div>
                </div>
              </div>
              <img
                src="<%= image_card_path(@card, v: (@card.artwork_generation || @card.updated_at.to_i)) %>"
                alt="card image"
                class="ktb-card__artImage"
                data-card-artwork-target="image"
                style="display: <%= refining ? 'none' : '' %>;"
                loading="lazy"
                decoding="async"
              >
            </div>
          </div>

          <div class="ktb-card__footer">
            <div class="ktb-card__attack" aria-label="æ”»æ’ƒåŠ›">
              æ”»æ’ƒåŠ› <span class="ktb-card__attackValue"><%= @card.attack_power %></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

