# Gap Analysis（仕様/非機能/運用の抜け漏れ整理）

この文書は [PRD.md](../PRD.md) を実装可能な仕様へ落とすための抜け漏れ整理です。

## 決定済み（ユーザー回答より）

- **プラットフォーム**: Web
- **初期対戦**: オフライン（CPU戦）
- **クラウド**: GCPサービス利用
- **構成方針**: ハイブリッド（Firebase系 + Cloud Run）
- **フロント**: Ruby on Rails
- **API**: Ruby on Rails（Cloud Run想定）
- **カード**: 1枚に「カード名/じゃんけん/攻撃力/イラスト/レアリティ」をすべて含む
- **バトル進行**: 毎ターン、手札3枚（グー/チョキ/パー）から1枚を選ぶ
- **ダメージ倍率**: ユーザーが選択したじゃんけんで勝つと 1.5 倍
- **1.5倍端数**: 四捨五入
- **日次報酬**: 1日1回、揃うまで重複なし
- **日次リセット**: JST 0:00
- **キャラ（じゃんけん選択）**: 後から変更可

## 未確定（実装に影響が大きい）

### バトル仕様

- **あいこ時の処理**
  - ユーザー回答: 「初期体力の5%のダメージ」
  - 確定: **両者が「初期体力の5%」を減らす**
  - 補足: 初期HP=200なので、毎回 **10ダメージ**（=200×0.05）
- **ターン上限/決着条件**
  - HP0勝利は明記あり。無限戦にならないためのターン上限の要否
- **先攻・後攻の概念**
  - 同時選択で毎ターン解決なら不要だが、UI/演出上の扱いを決めたい
- **CPUの出し手ロジック**
  - 完全ランダム/重み/ユーザーの傾向に応じる等

### カード/デッキ仕様

- **カードマスタの総数（初期）**
  - 日次報酬の「揃うまで重複なし」の母集団が未確定（TBD）
- **攻撃力の範囲・最小単位**
  - 合計攻撃力100までの制約があるため、1枚の上限/下限が必要
- **「合計攻撃力100まで」の計算対象**
  - 選択した3枚の合計か、別バフ等込みか

### 日次報酬（運用/不正対策に直結）

- **母集団の管理方法**
  - activeフラグで運用、シーズン制、固定集合など
  - 暫定前提（設計用）: **カードマスタの `active=true` を母集団にし、未所持を優先して付与**
- **コンプリート後の扱い**
  - 何も付与しない / 重複解禁 / 別報酬（通貨等）
- **未受取日の繰越**
  - 受取忘れの救済（例: ストック最大N日）を入れるか

### アカウント/プロフィール

- **認証方法**
  - 暫定前提: Firebase Authentication（Email/Google等は後で選択）
- **表示名/アイコン等のプロフィール項目**
  - PRDにはないが、UI設計で必要になりやすい

## 非機能・運用（MVPでも最低限決めたい）

- **セキュリティ**
  - Firebase IDトークン検証（Rails API側）
  - 日次報酬の多重受取防止（サーバ側で原子更新）
- **監視/ログ**
  - Cloud Logging / Error Reporting
- **環境分離**
  - dev/stg/prod の分離（Firebaseプロジェクト、GCPプロジェクト）

## 次に決めると良い順（おすすめ）

1. あいこ時のダメージ仕様（対象/基準/端数）
2. 日次報酬の母集団とコンプリート後の扱い
3. CPU戦のAI（まずはランダムでOKか）
4. カード総数と攻撃力レンジ（マスタ設計）

